<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><meta name="theme-color" content="#2d4356"><meta name="baidu-site-verification"><title>Virtual_Threads | è€ƒç ”æˆ°å£«Tim</title><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.png"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script><script src="https://sf-cdn.coze.com/obj/unpkg-va/flow-platform/chat-app-sdk/1.2.0-beta.10/libs/oversea/index.js"></script><script>window.addEventListener('load', function() {
  new CozeWebSDK.WebChatClient({
    config: {
      type: 'bot',
      bot_id: '7600336673834188805',
      isIframe: false,
    },
    auth: {
      type: 'token',
      token: 'pat_j9X00AidZby1KiO6lAAuljTyRX3K3NY2cboYFAJAZx04Qz0HKnowMFgkCs2wPyaD',
      onRefreshToken: function() {
        return new Promise(function(resolve) {
          // é€™è£¡å›å‚³ç•¶å‰çš„ Token å³å¯è§£æ±º SDK çš„å¼·åˆ¶è¦æ±‚
          resolve('pat_j9X00AidZby1KiO6lAAuljTyRX3K3NY2cboYFAJAZx04Qz0HKnowMFgkCs2wPyaD');
        });
      }
    },
    userInfo: {
      id: 'å´”ç¾å¨œç§€',
      url: 'https://img.ltn.com.tw/Upload/ent/page/800/2018/03/04/phpq3GMjX.png',
      nickname: 'å´”ç¾å¨œç§€',
    },
    ui: {
      base: {
        icon: 'https://www.very1.com.tw/images/home/line-fun%20(1).png',
        layout: 'pc',
        lang: 'zh-CN',
        zIndex: 1000,
      },
      header: {
        isShow: true,
        isNeedClose: true,
      },
      asstBtn: {
        isNeed: true,
      },
      footer: {
        isShow: true,
        expressionText: 'contact tim 0975491139',
      },
      chatBot: {
        title: 'Tim_Asistant',
        uploadable: true,
        width: 350,
      },
    },
  });
});</script><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="è€ƒç ”æˆ°å£«Tim" type="application/atom+xml">
</head><link rel="stylesheet" type="text/css" href="/plugins/highlight/atom-one-dark.min.css"><script type="text/javascript" src="/plugins/highlight/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();
</script><script type="text/javascript" src="/js/ready.js" async></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><body class="night"><div class="mobile-head" id="mobile-head"><div class="navbar-icon"><span></span><span></span><span></span></div><div class="navbar-title"><a href="/">TIM</a></div><div class="navbar-search"><!--= show a circle here--></div></div><div class="h-wrapper" id="menu"><nav class="h-head box"><div class="m-hdimg"><a class="hdimg img" href="/"><img class="nofancybox" src="/img/dog.jpg" width="128" height="128"></a><h1 class="ttl"><a href="/">è€ƒç ”æˆ°å£«Tim</a></h1></div><p class="m-desc"><img width = 80px height = 80px src ='https://timtimtimtimtim.pythonanywhere.com/static/qr.png'/></p><div class="m-nav"><ul><li><span class="dot">â—</span><a href="/categories/">å°ˆæ¡ˆ</a></li><li><span class="dot">â—</span><a href="/certificate/">è­‰æ›¸</a></li><li><span class="dot">â—</span><a href="/about/">é—œæ–¼</a></li><li><span class="dot">â—</span><a href="/archives/">æ­·ç¨‹</a></li><li><span class="dot">â—</span><a href="/%E7%AD%86%E8%A8%98/">ç­†è¨˜</a></li><li class="m-sch"><form class="form" id="j-formsch" method="get"><input class="txt" type="text" id="local-search-input" name="q" value="æœç´¢" onfocus="if(this.value=='æœç´¢'){this.value='';}" onblur="if(this.value==''){this.value='æœç´¢';}"><input type="text" style="display:none;"></form></li></ul><div id="local-search-result"></div></div></nav></div><div id="back2Top"><a class="fa fa-arrow-up" title="Back to top" href="#"></a></div><div class="box" id="container"><div class="l-wrapper"><div class="l-content box"><div class="l-post l-post-art"><article class="p-art"><div class="p-header box"><h1 class="p-title">Virtual_Threads</h1><div class="p-info"><span class="p-date"><i class="fa fa-calendar"></i><a href="/2026/02/11/Virtual-Threads/">2026-02-11</a></span><span class="p-view" id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span></span></div></div><div class="p-content"><h1 id="Virtual-Threads-æ‰æ˜¯-Java-Web-çš„æ­£è§£"><a href="#Virtual-Threads-æ‰æ˜¯-Java-Web-çš„æ­£è§£" class="headerlink" title="Virtual Threads æ‰æ˜¯ Java Web çš„æ­£è§£"></a>Virtual Threads æ‰æ˜¯ Java Web çš„æ­£è§£</h1><p>å¦ç™½èªªï¼Œæˆ‘ä¸€ç›´è¦ºå¾—å¾ˆå¤šåœ˜éšŠ<strong>ä¸æ˜¯ç³»çµ±æ’ä¸ä½</strong>ï¼Œ<br>è€Œæ˜¯<strong>å·¥ç¨‹è¤‡é›œåº¦å…ˆæŠŠäººæå®äº†</strong>ã€‚</p>
<p>æœ€ç¶“å…¸çš„ä¾‹å­å°±æ˜¯ï¼š<br>ğŸ‘‰ æŠŠåŸæœ¬é‹ä½œè‰¯å¥½çš„ Spring MVCï¼Œç¡¬ç”Ÿç”Ÿæ”¹æˆ WebFluxã€‚</p>
<p>ç†ç”±é€šå¸¸åªæœ‰ä¸€å¥è©±ï¼š</p>
<blockquote>
<p>ã€ŒNon-blockingï¼Œæ•ˆèƒ½æ¯”è¼ƒå¥½ã€‚ã€</p>
</blockquote>
<p>ä½†å¯¦éš›ä¸Šå‘¢ï¼Ÿ<br>æ•ˆèƒ½æ²’æœ‰é£›èµ·ä¾†ï¼ŒDebug å»ç›´æ¥ä¸‹åœ°ç„ã€‚</p>
<p>ç›´åˆ° <strong>JDK 21 çš„ Virtual Threads å‡ºç¾</strong></p>
<blockquote>
<p><strong>Java Webï¼Œçµ‚æ–¼å›åˆ°ä¸€æ¢ã€Œäººé¡èƒ½èµ°çš„è·¯ã€ã€‚</strong></p>
</blockquote>
<hr>
<h2 id="Thread-ç‚ºä»€éº¼ä¸€ç›´æ˜¯-Java-çš„ç—›ï¼Ÿ"><a href="#Thread-ç‚ºä»€éº¼ä¸€ç›´æ˜¯-Java-çš„ç—›ï¼Ÿ" class="headerlink" title="Thread ç‚ºä»€éº¼ä¸€ç›´æ˜¯ Java çš„ç—›ï¼Ÿ"></a>Thread ç‚ºä»€éº¼ä¸€ç›´æ˜¯ Java çš„ç—›ï¼Ÿ</h2><p>å…ˆè¬›ä¸€å€‹æœ€åŸºæœ¬ã€ä½†å¾ˆå¤šäººå…¶å¯¦æ²’çœŸçš„æƒ³æ¸…æ¥šçš„äº‹ï¼š</p>
<blockquote>
<p><strong>Thread æ˜¯ã€Œèª°åœ¨åŸ·è¡Œä½ çš„ç¨‹å¼ç¢¼ã€</strong></p>
</blockquote>
<p>åœ¨å‚³çµ±çš„ Java Web æ¶æ§‹è£¡ï¼š</p>
<ul>
<li>ä¸€å€‹ HTTP request  </li>
<li>å°æ‡‰ä¸€æ¢ Thread  </li>
<li>Thread ä¸€è·¯è·‘ Controller â†’ Service â†’ DB</li>
</ul>
<p>åªè¦é‡åˆ° IOï¼ˆè³‡æ–™åº«ã€å¤–éƒ¨ APIï¼‰ï¼š</p>
<p>ğŸ‘‰ <strong>Thread å°±æœƒå¡ä½ç­‰å¾…</strong></p>
<p>é€™åœ¨éå»æ˜¯å€‹å¤§å•é¡Œï¼Œå› ç‚ºï¼š</p>
<ul>
<li>OS Thread éå¸¸é‡</li>
<li>èƒ½é–‹çš„æ•¸é‡æœ‰é™</li>
<li>ä¸€å¡ä½å°±ç­‰æ–¼æµªè²»è³‡æº</li>
</ul>
<p>æ–¼æ˜¯æ•´å€‹ Java ç”Ÿæ…‹é–‹å§‹ã€Œæ‰­æ›²ã€ï¼Œ<br>å¤§å®¶é–‹å§‹ä¸å¯«äººé¡èƒ½çœ‹æ‡‚çš„ç¨‹å¼ç¢¼ï¼Œåªç‚ºäº†èº²é¿ blockingã€‚</p>
<hr>
<h2 id="äºŒã€WebFlux-åœ¨è§£ä»€éº¼å•é¡Œï¼Ÿ"><a href="#äºŒã€WebFlux-åœ¨è§£ä»€éº¼å•é¡Œï¼Ÿ" class="headerlink" title="äºŒã€WebFlux åœ¨è§£ä»€éº¼å•é¡Œï¼Ÿ"></a>äºŒã€WebFlux åœ¨è§£ä»€éº¼å•é¡Œï¼Ÿ</h2><p>WebFlux çš„å‡ºç™¼é»å…¶å¯¦å¾ˆå–®ç´”ï¼š</p>
<blockquote>
<p><strong>ä¸è¦è®“ Thread ç­‰ IO</strong></p>
</blockquote>
<p>å®ƒçš„ä¸–ç•Œè§€æ˜¯ï¼š</p>
<ul>
<li>å°‘é‡ Event Loop Thread  </li>
<li>æ‰€æœ‰ IO éƒ½å¿…é ˆ non-blocking  </li>
<li>ç”¨ Mono &#x2F; Flux ä¸²èµ·æ•´å€‹æµç¨‹</li>
</ul>
<p>ç†è«–ä¸Šçœ‹èµ·ä¾†å¾ˆç¾ï¼š</p>
<ul>
<li>Thread åˆ©ç”¨ç‡é«˜  </li>
<li>é«˜ä½µç™¼æ²’å•é¡Œ</li>
</ul>
<p>ä½†ç¾å¯¦ä¸–ç•Œå¾€å¾€æ˜¯ï¼š</p>
<ul>
<li>Stack trace ç ´ç¢  </li>
<li>Debug æ¥µåº¦ç—›è‹¦  </li>
<li>ä¸€å€‹ blocking call å°±èƒ½ç‚¸æ•´å€‹ç³»çµ±</li>
</ul>
<blockquote>
<p><strong>å¤§å¤šæ•¸æ¥­å‹™ç³»çµ±çš„ç“¶é ¸ï¼Œæ ¹æœ¬ä¸åœ¨ Thread</strong></p>
</blockquote>
<p>è€Œæ˜¯åœ¨ï¼š</p>
<ul>
<li>DB æœ¬èº«å°±æ…¢  </li>
<li>å¤–éƒ¨ API ä¸ç©©  </li>
<li>å•†æ¥­é‚è¼¯è¤‡é›œ</li>
</ul>
<p>çµæœå¸¸è¦‹çš„çµå±€æ˜¯ï¼š</p>
<ol>
<li>ç³»çµ±æ²’æœ‰æ˜é¡¯è®Šå¿«  </li>
<li>å·¥ç¨‹è¤‡é›œåº¦å»æš´å¢  </li>
<li>åœ˜éšŠå£«æ°£ä¸€è·¯ä¸‹æ»‘</li>
</ol>
<hr>
<h2 id="Virtual-Threads-æ”¹è®Šäº†ä»€éº¼ï¼Ÿ"><a href="#Virtual-Threads-æ”¹è®Šäº†ä»€éº¼ï¼Ÿ" class="headerlink" title="Virtual Threads æ”¹è®Šäº†ä»€éº¼ï¼Ÿ"></a>Virtual Threads æ”¹è®Šäº†ä»€éº¼ï¼Ÿ</h2><p>JDK 21 çš„ Virtual Threadsï¼Œåªåšäº†ä¸€ä»¶äº‹ï¼Œ<br>ä½†é€™ä»¶äº‹éå¸¸é—œéµï¼š</p>
<blockquote>
<p><strong>è®“ã€ŒåŒæ­¥å¯«æ³•ã€ä¹Ÿèƒ½å…·å‚™ã€ŒéåŒæ­¥çš„ scalabilityã€</strong></p>
</blockquote>
<p>éå»ï¼š</p>
<ul>
<li>Blocking &#x3D; ä½”ä½ä¸€æ¢ OS Thread  </li>
<li>Thread ä¸€å¤šï¼Œç³»çµ±å°±æ’ä¸ä½</li>
</ul>
<p>ç¾åœ¨ï¼š</p>
<ul>
<li>Blocking &#x3D; JVM å¹«ä½ æ› Virtual Thread  </li>
<li>OS Thread å»è·‘åˆ¥çš„ä»»å‹™</li>
</ul>
<p>Virtual Thread çš„ç‰¹æ€§å¾ˆç°¡å–®ï¼š</p>
<ul>
<li>éå¸¸è¼•é‡  </li>
<li>ç”± JVM ç®¡ç†ï¼Œä¸æ˜¯ OS  </li>
<li>IO æ™‚è‡ªå‹• park &#x2F; unpark</li>
</ul>
<p>ä½ å¯«çš„ç¨‹å¼ç¢¼ä¾ç„¶æ˜¯åŒæ­¥çš„ï¼š</p>
<pre><code class="java">User user = userService.getUser(id);
Order order = orderService.getOrder(user);
return new Result(user, order);
</code></pre>
</div><div class="p-copyright"><blockquote><div class="p-copyright-author"><span class="p-copyright-key">æœ¬æ–‡ä½œè€…ï¼š</span><span class="p-copytight-value"><a href="mailto:litreily@163.com">TIM</a></span></div><div class="p-copyright-link"><span class="p-copyright-key">æœ¬æ–‡é€£æ¥ï¼š</span><span class="p-copytight-value"><a href="/2026/02/11/Virtual-Threads/">https://Timtimtimchen.github.io/2026/02/11/Virtual-Threads/</a></span></div></blockquote></div></article><div class="p-info box"><span class="p-tags"><i class="fa fa-tags"></i><a href="/tags/Java/">Java</a><a href="/tags/Virtual-Threads/">Virtual Threads</a><a href="/tags/WebFlux/">WebFlux</a><a href="/tags/Spring-Boot/">Spring Boot</a></span></div><aside id="toc"><div class="toc-title">ç›®å½•</div><nav><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Virtual-Threads-%E6%89%8D%E6%98%AF-Java-Web-%E7%9A%84%E6%AD%A3%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">Virtual Threads æ‰æ˜¯ Java Web çš„æ­£è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Thread-%E7%82%BA%E4%BB%80%E9%BA%BC%E4%B8%80%E7%9B%B4%E6%98%AF-Java-%E7%9A%84%E7%97%9B%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">Thread ç‚ºä»€éº¼ä¸€ç›´æ˜¯ Java çš„ç—›ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81WebFlux-%E5%9C%A8%E8%A7%A3%E4%BB%80%E9%BA%BC%E5%95%8F%E9%A1%8C%EF%BC%9F"><span class="toc-number">1.2.</span> <span class="toc-text">äºŒã€WebFlux åœ¨è§£ä»€éº¼å•é¡Œï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Virtual-Threads-%E6%94%B9%E8%AE%8A%E4%BA%86%E4%BB%80%E9%BA%BC%EF%BC%9F"><span class="toc-number">1.3.</span> <span class="toc-text">Virtual Threads æ”¹è®Šäº†ä»€éº¼ï¼Ÿ</span></a></li></ol></li></ol></nav></aside></div><section class="p-ext"><div class="l-pager l-pager-dtl box"><a class="next" href="/2024/10/25/blockchain/">BlockChain(åŠ å¯†è²¨å¹£/NFT) &gt;</a></div></section><footer><p><strong>Tim's blog</strong> Â© 2016 - 2026 <a href="/." rel="nofollow">è€ƒç ”æˆ°å£«Tim</a> | <img src="https://timtimtimtimtim.pythonanywhere.com/static/instagram.jpg" width="50px" height="50px"></p></footer></div></div></div><script type="text/javascript" src="/js/search.js"></script><script type="text/javascript" src="/js/top.js"></script><script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
    search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script></body></html>